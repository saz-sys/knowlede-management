# クイックスタートガイド: 動画サムネイル抽出機能

**作成日**: 2025年9月5日
**対象**: 開発者、テスター、エンドユーザー

## 概要
この機能を素早く試すためのステップバイステップガイドです。開発完了後にこの手順で動作確認を行います。

## 前提条件

### システム要件
- Python 3.11以上
- 4GB以上のRAM
- 1GB以上の空きディスク容量
- Windows 10/macOS 10.15/Ubuntu 20.04以上

### 依存関係
```bash
pip install -r requirements.txt
```

必要なパッケージ：
- opencv-python==4.8.1.78
- mediapipe==0.10.9
- Pillow==10.0.1
- numpy==1.24.4

### テスト用データ
以下のサンプル動画を準備：
- `sample_anime_short.mp4`（30秒、複数キャラクター）
- `sample_anime_long.mp4`（5分、シーン変化あり）
- `sample_no_faces.mp4`（顔なし動画、エラーテスト用）

## 基本的な使用方法

### 1. GUI アプリケーション起動
```bash
python -m src.gui.main_window
```

期待される結果：
- メインウィンドウが表示される
- タイトルバーに「動画サムネイル抽出ツール v1.0.0」
- ファイル選択、設定、進捗、プレビューエリアが表示される

### 2. 動画ファイル選択
1. 「動画を選択」ボタンをクリック
2. ファイルダイアログからMP4ファイルを選択
3. 「開く」をクリック

期待される結果：
- 動画ファイル名が表示される
- 動画情報（再生時間、解像度、fps）が表示される
- 設定エリアがアクティブになる

### 3. サムネイル設定
1. 生成枚数を指定（1-20）
2. 出力サイズを指定（例：1920x1080）
3. 向きを選択（横型/縦型/自動）
4. 保存先フォルダを選択

期待される結果：
- 各設定値が保存される
- 「サムネイル生成」ボタンがアクティブになる

### 4. サムネイル生成
1. 「サムネイル生成」ボタンをクリック
2. 進捗バーで処理状況を確認

期待される結果：
- 進捗バーが0%から100%まで進行
- 状態メッセージが更新される（フレーム抽出中、顔検出中、生成中）
- 完了後にサムネイル候補が表示される

### 5. サムネイル選択と保存
1. プレビューエリアでサムネイルを選択
2. 「選択したものを保存」ボタンをクリック

期待される結果：
- 指定フォルダにPNGファイルが保存される
- ファイル名：`thumbnail_01.png`, `thumbnail_02.png`等
- 成功メッセージが表示される

## コマンドライン使用方法

### 基本的なサムネイル抽出
```bash
python -m src.cli.main extract \
  --input sample_anime_short.mp4 \
  --output ./thumbnails/ \
  --count 5 \
  --size 1920x1080 \
  --orientation landscape
```

期待される結果：
- `./thumbnails/`ディレクトリに5枚のPNGファイルが生成
- 各ファイルサイズが1920x1080ピクセル
- ファイル名にタイムスタンプが含まれる

### 詳細設定での抽出
```bash
python -m src.cli.main extract \
  --input sample_anime_long.mp4 \
  --output ./custom_thumbnails/ \
  --count 10 \
  --size 1280x720 \
  --orientation portrait \
  --confidence 0.7 \
  --diversity-weight 0.8 \
  --prefix "anime_scene"
```

期待される結果：
- 高い信頼度（0.7）で顔検出
- 多様性重視（0.8）でフレーム選択
- ファイル名：`anime_scene_01.png`等

## テストケース

### 正常系テスト

#### T1: 標準的な動画での抽出
```bash
# 準備
動画: sample_anime_short.mp4 (30秒、キャラクター3人)
設定: 5枚、1920x1080、横型

# 実行
GUI または CLI で抽出実行

# 検証
- 5枚のサムネイルが生成される
- 各サムネイルに異なるキャラクターまたは構図
- すべて1920x1080サイズ
- PNG形式で保存
```

#### T2: 長尺動画での多様性確認
```bash
# 準備
動画: sample_anime_long.mp4 (5分、複数シーン)
設定: 10枚、1280x720、縦型

# 実行
多様性重み0.8で抽出

# 検証
- 10枚すべて異なる構図
- シーンの変化が反映されている
- 顔が明確に写っている
- 1280x720の縦型比率
```

### エラーケーステスト

#### E1: 顔なし動画
```bash
# 準備
動画: sample_no_faces.mp4

# 実行
通常設定で抽出実行

# 検証
エラーメッセージ: "この動画からキャラクターの顔を検出できませんでした。別の動画を選択してください。"
```

#### E2: 短尺動画
```bash
# 準備
動画: very_short.mp4 (3秒)

# 実行
10枚設定で抽出実行

# 検証
エラーメッセージ: "動画が短すぎるため、十分なサムネイルを生成できません。最低10秒以上の動画を選択してください。"
```

#### E3: 非対応形式
```bash
# 準備
ファイル: sample_video.avi

# 実行
ファイル選択で .avi を指定

# 検証
エラーメッセージ: "対応していない動画形式です。MP4形式の動画を選択してください。"
```

#### E4: 権限エラー
```bash
# 準備
読み取り専用フォルダを出力先に指定

# 実行
保存実行

# 検証
エラーメッセージ: "保存先フォルダに書き込み権限がありません。別のフォルダを選択するか、管理者権限で実行してください。"
```

### パフォーマンステスト

#### P1: 処理時間測定
```bash
# 準備
動画: 10分のMP4ファイル
設定: 5枚サムネイル、1920x1080

# 実行と測定
開始時刻を記録
抽出実行
終了時刻を記録

# 検証
処理時間が60秒以内（目標: 30秒以内）
```

#### P2: メモリ使用量確認
```bash
# 準備
大きなサイズの動画ファイル（1GB）

# 実行
タスクマネージャーでメモリ使用量を監視

# 検証
最大メモリ使用量が2GB以内
```

## トラブルシューティング

### よくある問題

#### 問題1: 動画が読み込めない
- **症状**: ファイル選択後にエラー
- **原因**: 破損ファイルまたは対応していないコーデック
- **解決**: 別のMP4ファイルを試す、メディアプレイヤーでの再生確認

#### 問題2: サムネイルに顔が写らない
- **症状**: 生成されたサムネイルに顔がない
- **原因**: 顔検出の信頼度設定が高すぎる
- **解決**: 信頼度を0.3に下げて再実行

#### 問題3: 処理が遅い
- **症状**: 長時間処理が終わらない
- **原因**: 高解像度動画または古いハードウェア
- **解決**: 動画を720pに変換、または生成枚数を減らす

#### 問題4: GUI が応答しない
- **症状**: 処理中にウィンドウが固まる
- **原因**: メインスレッドでの重い処理
- **解決**: アプリケーション再起動、非同期処理の実装確認

### ログファイル確認
```bash
# ログファイルの場所
Windows: %APPDATA%/ThumbnailExtractor/logs/
macOS: ~/Library/Application Support/ThumbnailExtractor/logs/
Linux: ~/.local/share/ThumbnailExtractor/logs/

# 最新ログの確認
tail -f application.log
```

### 開発者向けデバッグ
```bash
# デバッグモードで実行
python -m src.gui.main_window --debug

# 詳細ログ出力
export LOG_LEVEL=DEBUG
python -m src.gui.main_window

# テスト実行
pytest tests/ -v
```

## 成功基準

### 機能要件チェック
- [ ] MP4動画の読み込み成功
- [ ] キャラクター顔の検出成功（80%以上の精度）
- [ ] 指定枚数のサムネイル生成
- [ ] PNG形式での保存成功
- [ ] 縦型/横型の切り替え機能
- [ ] ユーザー指定サイズでの出力
- [ ] 構図多様性の確保
- [ ] エラーメッセージの適切な表示

### パフォーマンス要件チェック
- [ ] 10分動画の処理が60秒以内
- [ ] メモリ使用量が2GB以内
- [ ] GUI の応答性維持
- [ ] 複数ファイルの連続処理

### ユーザビリティ要件チェック
- [ ] 直感的なGUI操作
- [ ] 明確なエラーメッセージ
- [ ] 適切な進捗表示
- [ ] ヘルプドキュメントの充実

このクイックスタートガイドを使用して、実装完了後の動作確認を行ってください。
