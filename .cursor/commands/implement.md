---
description: "tasks.mdで定義されたタスクを実行して機能を実装します。これは仕様駆動開発ライフサイクルの第4ステップです。"
---

# タスク実行と機能実装

tasks.mdで定義されたタスクを実行して機能を実装します。

これは仕様駆動開発ライフサイクルの第4ステップです。

引数として提供されたタスク指定に基づいて、以下を実行してください：

1. リポジトリルートから `scripts/check-task-prerequisites.sh --json` を実行し、FEATURE_DIRとAVAILABLE_DOCSリストを解析します。すべてのパスは絶対パスである必要があります。

2. タスクファイルを読み込んで分析します：
   - `FEATURE_DIR/tasks.md` を読み込みます
   - 全タスクリストと依存関係を把握します
   - 現在のタスク実行状況を確認します（チェックマーク状態）

3. 実行対象タスクを特定します：
   - 引数でタスクIDが指定された場合：そのタスクのみ実行
   - 引数で"next"が指定された場合：次の未完了タスクを実行
   - 引数で"parallel"が指定された場合：実行可能な[P]タスクをすべて実行
   - 引数が未指定の場合：次の未完了タスクを実行

4. タスク実行前の検証：
   - 前提条件となるタスクが完了しているかチェック
   - [P]マークのないタスクは並列実行対象外であることを確認
   - 同じファイルを操作する他のタスクが実行中でないことを確認

5. 必要な設計ドキュメントを読み込みます：
   - `plan.md`: 技術スタック、ライブラリ、プロジェクト構造
   - `data-model.md`: エンティティとデータ構造（存在する場合）
   - `contracts/`: API仕様とエンドポイント（存在する場合）
   - `research.md`: 技術的決定事項（存在する場合）
   - `quickstart.md`: テストシナリオ（存在する場合）

6. タスクを実行します：
   **セットアップタスク**：
   - プロジェクト構造の作成
   - 依存関係のインストール
   - 設定ファイルの作成

   **テストタスク [P]**（TDD - 実装前に実行）：
   - 契約テストの作成（各エンドポイント用）
   - 統合テストの作成（各ユーザーストーリー用）
   - テストが最初は失敗することを確認

   **コアタスク**：
   - モデル/エンティティの実装
   - サービス層の実装
   - CLIコマンドの実装
   - APIエンドポイントの実装

   **統合タスク**：
   - データベース接続
   - ミドルウェアの設定
   - ログ機能の実装

   **仕上げタスク [P]**：
   - ユニットテストの実装
   - パフォーマンステストの実行
   - ドキュメントの更新

7. 実行後の処理：
   - 作成/変更されたファイルをリストアップ
   - テストを実行して動作確認
   - `tasks.md`の該当タスクにチェックマークを追加
   - 変更をコミット（タスクID付きコミットメッセージ）

8. 進捗報告：
   - 完了したタスクID
   - 作成/変更されたファイル一覧
   - テスト結果
   - 次に実行可能なタスク

## 実行モード

### 単一タスク実行

```text
{ARGS} = "T005"
→ T005のみを実行
```

### 次のタスク実行

```text
{ARGS} = "next" または未指定
→ 未完了の次のタスクを実行
```

### 並列タスク実行

```text
{ARGS} = "parallel"
→ 実行可能な[P]タスクをすべて実行
```

### 範囲指定実行

```text
{ARGS} = "T005-T008"
→ T005からT008までを順次実行
```

## エラーハンドリング

- **依存関係エラー**: 前提タスクが未完了の場合は停止し、必要なタスクを報告
- **並列競合エラー**: 同じファイルを変更する複数タスクが検出された場合は停止
- **テスト失敗**: TDDフェーズでテストが成功してしまった場合は警告
- **実装エラー**: 実装後にテストが失敗する場合は修正を試行

## 品質保証

- **コード品質**: リンターとフォーマッターを実行
- **テスト網羅性**: 実装したコードに対応するテストがあることを確認
- **仕様準拠**: 元の機能仕様と実装計画に沿っていることを検証
- **文書同期**: 実装内容とドキュメントの一貫性を確認

## 出力形式

実行完了時に以下を報告：

```text
✅ タスク T005 完了: "tests/contract/test_users_get.py でGET /api/users/{id} の契約テスト"

📁 変更されたファイル:
- tests/contract/test_users_get.py (新規作成)
- tests/fixtures/user_data.py (更新)

🧪 テスト結果:
- 契約テスト: 1件失敗（期待通り - TDD）
- 既存テスト: すべて成功

📋 進捗:
- 完了: 5/23 タスク
- 次のタスク: T006 "tests/integration/test_registration.py でユーザー登録の統合テスト"
- 並列実行可能: T006, T007 ([P]マーク付き)

💾 コミット: "T005: 契約テスト GET /api/users/{id} を追加"
```

注意：各タスクは設計ドキュメントの内容に基づいて自己完結的に実行できるよう、十分な詳細を含んでいる必要があります。実装中に不明点があれば、設計フェーズに戻ってドキュメントを更新することを推奨します。

実行コンテキスト：{ARGS}
